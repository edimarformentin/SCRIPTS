<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>VaaS ‚Ä¢ Admin</title>
  <link rel="stylesheet" href="/css/modern.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<div class="app-container">
  <!-- Header -->
  <header class="header">
    <a href="/index.html" class="header-brand">
      <span class="header-brand-icon">üìπ</span>
      <span>VaaS</span>
    </a>
    <div class="header-actions">
      <button class="btn btn-ghost" id="btn-voltar">
        ‚Üê Voltar
      </button>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="sidebar">
    <nav class="sidebar-nav">
      <a href="/index.html" class="sidebar-nav-item">
        <span class="sidebar-nav-item-icon">üë•</span>
        <span>Clientes</span>
      </a>
      <a href="/admin.html" class="sidebar-nav-item active">
        <span class="sidebar-nav-item-icon">‚öôÔ∏è</span>
        <span>Admin</span>
      </a>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="page-header">
      <h1 class="page-title">Administra√ß√£o</h1>
      <p class="page-subtitle">Monitor do sistema, GPU, backup e controle</p>
    </div>

    <!-- GPU Monitor Section -->
    <div class="card mb-4" id="gpu-section" style="display: none;">
      <div class="card-header">
        <div>
          <h2 class="card-title">üéÆ Monitor GPU</h2>
          <p style="color: var(--text-secondary); margin-top: 0.25rem;">Monitoramento em tempo real da GPU NVIDIA</p>
        </div>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <label style="color: var(--text-secondary); font-size: 0.875rem;">Atualizar a cada:</label>
          <select id="gpu-refresh-rate" class="form-select" style="width: auto; padding: 0.375rem 0.75rem;">
            <option value="1000">1 seg</option>
            <option value="2000">2 seg</option>
            <option value="3000" selected>3 seg</option>
            <option value="5000">5 seg</option>
            <option value="10000">10 seg</option>
          </select>
          <button class="btn btn-sm btn-ghost" id="btn-toggle-gpu">
            <span id="gpu-status-icon">‚è∏Ô∏è</span>
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="grid grid-cols-2" id="gpu-cards-grid">
          <!-- GPU cards will be inserted here -->
        </div>

        <!-- GPU Charts -->
        <div class="grid grid-cols-3 mt-4">
          <div>
            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">Utiliza√ß√£o GPU (%)</h3>
            <canvas id="gpu-utilization-chart" style="max-height: 200px; width: 100%;"></canvas>
          </div>
          <div>
            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">Mem√≥ria GPU (MB)</h3>
            <canvas id="gpu-memory-chart" style="max-height: 200px; width: 100%;"></canvas>
          </div>
          <div style="border: 2px solid #3b82f6; padding: 0.5rem; background: rgba(59, 130, 246, 0.05);">
            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--primary); margin-bottom: 1rem;">üéÆ Uso GPU por C√¢mera (MB)</h3>
            <canvas id="cameras-active-chart" style="max-height: 200px; width: 100%; min-height: 180px;"></canvas>
          </div>
        </div>

        <!-- GPU Processes -->
        <div class="mt-4">
          <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">
            Processos na GPU (<span id="gpu-process-count">0</span>)
          </h3>
          <div id="gpu-processes-list" style="max-height: 200px; overflow-y: auto;">
            <!-- Processes will be inserted here -->
          </div>
        </div>
      </div>
    </div>

    <!-- System Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-card-icon primary">
            <span>üíª</span>
          </div>
        </div>
        <div class="stat-card-value"><span id="stat-cpu">0</span>%</div>
        <div class="stat-card-label">CPU</div>
      </div>

      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-card-icon warning">
            <span>üß†</span>
          </div>
        </div>
        <div class="stat-card-value">
          <span id="stat-memory-used">0</span> / <span id="stat-memory-total">0</span> GB
        </div>
        <div class="stat-card-label">Mem√≥ria</div>
        <div class="progress-bar mt-2">
          <div class="progress-fill" id="stat-memory-progress" style="width: 0%"></div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-card-icon danger">
            <span>üíæ</span>
          </div>
        </div>
        <div class="stat-card-value">
          <span id="stat-disk-used">0</span> / <span id="stat-disk-total">0</span> GB
        </div>
        <div class="stat-card-label">Disco</div>
        <div class="progress-bar mt-2">
          <div class="progress-fill" id="stat-disk-progress" style="width: 0%"></div>
        </div>
      </div>

      <div class="stat-card">
        <div class="stat-card-header">
          <div class="stat-card-icon success">
            <span>‚è±Ô∏è</span>
          </div>
        </div>
        <div class="stat-card-value" id="stat-uptime" style="font-size: 1.25rem;">0d 0h</div>
        <div class="stat-card-label">Uptime</div>
      </div>
    </div>

    <!-- Two Column Layout for Backup & Docker -->
    <div class="grid grid-cols-2 mt-4">
      <!-- Backup -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üíæ Backup</h2>
        </div>
        <div class="card-body">
          <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">
            Backup completo do sistema (exclui v√≠deos e banco)
          </p>

          <div class="form-group">
            <label class="form-label">Nome do Backup (opcional)</label>
            <input
              type="text"
              class="form-input"
              id="backup-custom-name"
              placeholder="Deixe vazio para nome autom√°tico"
            />
            <small style="color: var(--text-secondary); font-size: 0.75rem;">
              Ex: antes-atualizacao, pre-mudanca, etc.
            </small>
          </div>

          <button class="btn btn-success w-full" id="btn-criar-backup">
            üì¶ Criar Backup
          </button>

          <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-top: 1.5rem; margin-bottom: 0.75rem;">
            Backups Dispon√≠veis
          </h3>
          <div id="backup-list" style="max-height: 400px; overflow-y: auto;">
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Carregando...</p>
          </div>
        </div>
      </div>

      <!-- Docker Containers -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">üê≥ Containers Docker</h2>
        </div>
        <div class="card-body">
          <div id="containers-list" style="max-height: 550px; overflow-y: auto;">
            <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Carregando...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Git Section -->
    <div class="card mt-4">
      <div class="card-header">
        <h2 class="card-title">üîÄ Controle Git</h2>
      </div>
      <div class="card-body">
        <div class="grid grid-cols-2">
          <!-- Git Config -->
          <div>
            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">
              Configura√ß√£o Git
            </h3>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 0.375rem; padding: 0.75rem; margin-bottom: 1rem;">
              <p style="margin: 0; font-size: 0.75rem; color: #92400e;">
                <strong>‚ö†Ô∏è Para enviar c√≥digo pro GitHub/GitLab:</strong><br>
                1. Crie um <strong>Personal Access Token</strong><br>
                2. Coloque ele no campo Token abaixo<br>
                <a href="https://github.com/settings/tokens" target="_blank" style="color: #2563eb; text-decoration: underline;">‚Üí Criar Token no GitHub</a>
              </p>
            </div>

            <div class="form-group">
              <label class="form-label">Nome</label>
              <input type="text" class="form-input" id="git-user-name" placeholder="Seu Nome" />
            </div>
            <div class="form-group">
              <label class="form-label">Email</label>
              <input type="email" class="form-input" id="git-user-email" placeholder="seu@email.com" />
            </div>
            <div class="form-group">
              <label class="form-label">Reposit√≥rio (URL)</label>
              <input type="text" class="form-input" id="git-remote-url" placeholder="https://github.com/usuario/repo.git" />
              <small style="color: var(--text-secondary); font-size: 0.7rem;">
                Ex: https://github.com/usuario/vaas-system.git
              </small>
            </div>
            <div class="form-group">
              <label class="form-label">Token de Acesso üîë</label>
              <input type="password" class="form-input" id="git-token" placeholder="ghp_xxxxxxxxxxxx" />
              <small style="color: var(--text-secondary); font-size: 0.7rem;">
                Token pessoal do GitHub/GitLab (necess√°rio para enviar c√≥digo)
              </small>
            </div>
            <button class="btn btn-primary w-full" id="btn-save-git-config">
              ‚öôÔ∏è Salvar Configura√ß√µes (Nome, Email, Reposit√≥rio, Token)
            </button>

            <!-- Commit -->
            <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 2rem 0;">

            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">
              üìù Enviar C√≥digo para o GitHub/GitLab
            </h3>

            <div class="form-group">
              <label class="form-label">Descri√ß√£o das Altera√ß√µes</label>
              <textarea class="form-input" id="git-commit-message" rows="3" placeholder="Ex: Corrigido bug na tela de c√¢meras"></textarea>
              <small style="color: var(--text-secondary); font-size: 0.75rem;">
                Descreva o que foi alterado nesta vers√£o
              </small>
            </div>
            <div style="display: flex; gap: 0.5rem;">
              <button class="btn btn-ghost flex-1" id="btn-git-commit" title="Salva altera√ß√µes localmente (n√£o envia ainda)">
                üíæ Commit Local
              </button>
              <button class="btn btn-success flex-1" id="btn-git-commit-push" title="Salva e envia para o GitHub/GitLab">
                üöÄ Commit + Enviar pro Git
              </button>
            </div>
          </div>

          <!-- Git Status & Log -->
          <div>
            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">
              Status do Reposit√≥rio
            </h3>
            <div id="git-status" style="background: var(--card-bg); padding: 1rem; border-radius: 0.5rem; border: 1px solid var(--border-color); margin-bottom: 1.5rem; font-family: monospace; font-size: 0.8rem;">
              <p style="color: var(--text-secondary);">Carregando...</p>
            </div>

            <h3 style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 1rem;">
              √öltimos Commits
            </h3>
            <div id="git-log" style="max-height: 300px; overflow-y: auto;">
              <p style="color: var(--text-secondary); text-align: center; padding: 2rem;">Carregando...</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Logs Section -->
    <div class="card mt-4">
      <div class="card-header">
        <div>
          <h2 class="card-title">üìã Logs dos Servi√ßos</h2>
        </div>
        <div style="display: flex; gap: 0.5rem; align-items: center;">
          <select id="log-service" class="form-select" style="width: auto;">
            <option value="gestao-web">Backend</option>
            <option value="gestao-nginx">Frontend</option>
            <option value="mediamtx">MediaMTX</option>
            <option value="postgres-db">PostgreSQL</option>
            <option value="gestao-janitor">Janitor</option>
          </select>
          <button class="btn btn-sm btn-primary" id="btn-load-logs">
            üìÑ Carregar
          </button>
          <button class="btn btn-sm btn-ghost" id="btn-auto-refresh-logs">
            üîÑ Auto (5s)
          </button>
          <button class="btn btn-sm btn-ghost" id="btn-stop-refresh-logs">
            ‚è∏Ô∏è Parar
          </button>
        </div>
      </div>
      <div class="card-body">
        <div id="logs-viewer" style="background: #0a0a0a; padding: 1rem; border-radius: 0.5rem; font-family: monospace; font-size: 0.75rem; max-height: 500px; overflow-y: auto; white-space: pre-wrap; color: #94a3b8;">
          Selecione um servi√ßo e clique em "Carregar"
        </div>
      </div>
    </div>

  </main>
</div>

<!-- Toast -->
<div id="toast" class="toast hidden"></div>

<!-- Loading Overlay -->
<div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
  <div style="background: var(--card-bg); padding: 2rem; border-radius: 0.5rem; text-align: center;">
    <div class="loading-spinner" style="width: 40px; height: 40px; margin: 0 auto; border: 3px solid var(--border-color); border-top-color: var(--primary); border-radius: 50%; animation: spin 0.6s linear infinite;"></div>
    <p style="margin-top: 1rem; color: var(--text-secondary);">Processando...</p>
  </div>
</div>

<style>
@keyframes spin {
  to { transform: rotate(360deg); }
}

.progress-bar {
  width: 100%;
  height: 6px;
  background: var(--border-color);
  border-radius: 3px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--primary), var(--primary-hover));
  transition: width 0.3s ease;
}

.w-full {
  width: 100%;
}

.flex-1 {
  flex: 1;
}
</style>

<script defer src="/js/admin-modern.js"></script>
</body>
</html>
